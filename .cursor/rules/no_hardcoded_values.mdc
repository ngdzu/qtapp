---
alwaysApply: true
---

# No Hardcoded Values in Production Code

## Critical Rule: Never Hardcode Values in Production Code

**NEVER use hardcoded values in production code.** Always use variables, parameters, or constants that come from the actual runtime context.

## Why This Matters

Hardcoded values in production code:
- ❌ **Hide bugs:** Code appears to work but uses wrong data
- ❌ **Break functionality:** Values don't match actual runtime data
- ❌ **Make debugging impossible:** Logs show wrong information
- ❌ **Violate DRY principle:** Same value repeated in multiple places
- ❌ **Create maintenance burden:** Must update multiple hardcoded values

## Examples of What NOT to Do

### ❌ BAD: Hardcoded Values in Logging

```cpp
// ❌ BAD: Hardcoded MRN in logging
connect(lookupService, &IPatientLookupService::lookupCompleted,
        this, [](const QString& mrn, const Result<PatientIdentity>& result) {
    if (result.isSuccess()) {
        m_logService->info("Patient lookup succeeded", {
            {"mrn", "MRN-12345"},  // ❌ WRONG: Hardcoded value!
            {"name", patient.name}
        });
    } else {
        m_logService->warning("Patient lookup failed", {
            {"mrn", "MRN-12345"},  // ❌ WRONG: Hardcoded value!
            {"error", result.error().message}
        });
    }
});
```

**Problems:**
- Logs will always show "MRN-12345" even if the actual MRN is different
- Makes debugging impossible - logs don't reflect reality
- If the actual lookup fails for a different MRN, logs are misleading

### ❌ BAD: Hardcoded Values in Function Calls

```cpp
// ❌ BAD: Hardcoded patient MRN
void MonitoringService::sendTelemetry() {
    TelemetryBatch batch;
    batch.patientMrn = "MRN-12345";  // ❌ WRONG: Hardcoded!
    batch.deviceId = "ZM-ICU-MON-04";  // ❌ WRONG: Hardcoded!
    
    m_telemetryServer->sendBatch(batch);
}
```

**Problems:**
- Always sends data for the same patient, regardless of actual patient
- Device ID is wrong if device changes
- Breaks multi-patient scenarios

## ✅ GOOD: Use Variables and Parameters

### ✅ GOOD: Use Variables from Context

```cpp
// ✅ GOOD: Use variable from lambda parameter
connect(lookupService, &IPatientLookupService::lookupCompleted,
        this, [this](const QString& mrn, const Result<PatientIdentity>& result) {
    if (result.isSuccess()) {
        m_logService->info("Patient lookup succeeded", {
            {"mrn", mrn},  // ✅ Use variable from parameter
            {"name", patient.name}
        });
    } else {
        m_logService->warning("Patient lookup failed", {
            {"mrn", mrn},  // ✅ Use variable from parameter
            {"error", result.error().message}
        });
    }
});
```

### ✅ GOOD: Use Member Variables or Injected Dependencies

```cpp
// ✅ GOOD: Use member variables from context
void MonitoringService::sendTelemetry() {
    TelemetryBatch batch;
    batch.patientMrn = m_currentPatientMrn;  // ✅ From current patient context
    batch.deviceId = m_deviceId;  // ✅ From settings/configuration
    
    m_telemetryServer->sendBatch(batch);
}
```

### ✅ GOOD: Use Function Parameters

```cpp
// ✅ GOOD: Use function parameter
void MonitoringService::lookupPatient(const QString& mrn) {
    auto future = m_lookupService->lookupPatient(mrn);
    
    future.then([this, mrn](const Result<PatientIdentity>& result) {
        if (result.isSuccess()) {
            m_logService->info("Patient lookup succeeded", {
                {"mrn", mrn}  // ✅ Use parameter
            });
        }
    });
}
```

## When Hardcoded Values Are Acceptable

Hardcoded values are **ONLY acceptable** in:

1. **Test Code:** Test fixtures, mock data, unit test examples
   ```cpp
   // ✅ OK: Test code with hardcoded test data
   TEST(PatientLookup, Success) {
       MockPatientLookupService service;
       service.addMockPatient(PatientIdentity{
           .mrn = "MRN-12345",  // ✅ OK: Test fixture
           .name = "John Doe"
       });
   }
   ```

2. **Constants/Configuration:** Named constants for configuration values
   ```cpp
   // ✅ OK: Named constant for configuration
   constexpr int MAX_RETRY_ATTEMPTS = 3;
   constexpr int DEFAULT_TIMEOUT_MS = 5000;
   ```

3. **Default Values:** Sensible defaults that can be overridden
   ```cpp
   // ✅ OK: Default value that can be overridden
   int timeout = getTimeoutSetting("network.timeout", 5000);  // Default: 5000ms
   ```

4. **Documentation Examples:** When clearly marked as example/test data
   ```cpp
   // ✅ OK: Documentation example (clearly marked)
   // Example: Lookup patient
   QString exampleMrn = "MRN-12345";  // Example value
   auto future = service->lookupPatient(exampleMrn);
   ```

## Code Review Checklist

When reviewing code, check:

- [ ] No hardcoded IDs (patient MRN, device ID, user ID) in production code
- [ ] No hardcoded values in logging calls (use variables from context)
- [ ] No hardcoded values in function calls (use parameters or member variables)
- [ ] All runtime data comes from variables, parameters, or injected dependencies
- [ ] Test code clearly separated (hardcoded test data is OK in tests)

## Common Hardcoded Value Patterns to Avoid

| Pattern | ❌ Bad | ✅ Good |
|---------|--------|---------|
| **Logging** | `{"mrn", "MRN-12345"}` | `{"mrn", mrn}` |
| **Function Calls** | `lookupPatient("MRN-12345")` | `lookupPatient(mrn)` |
| **Object Properties** | `batch.patientMrn = "MRN-12345"` | `batch.patientMrn = m_currentPatientMrn` |
| **Error Messages** | `"Patient MRN-12345 not found"` | `QString("Patient %1 not found").arg(mrn)` |
| **Database Queries** | `WHERE mrn = 'MRN-12345'` | `WHERE mrn = :mrn` (with bindValue) |

## Enforcement

- **Code Review:** Reject PRs with hardcoded values in production code
- **Linting:** Consider adding static analysis rules to detect hardcoded IDs
- **Testing:** Verify logs contain actual runtime values, not hardcoded test values

## Related Guidelines

- [Logging Strategy (21_LOGGING_STRATEGY.md)](../project-dashboard/doc/z-monitor/architecture_and_design/21_LOGGING_STRATEGY.md) - Structured logging with context
- [Code Style Guidelines (code_style.mdc)](./code_style.mdc) - General coding standards
- [Dependency Injection (13_DEPENDENCY_INJECTION.md)](../project-dashboard/doc/z-monitor/architecture_and_design/13_DEPENDENCY_INJECTION.md) - Use DI for runtime values

---

**Remember:** If you find yourself typing a literal value that represents runtime data (patient ID, device ID, user ID, etc.), **STOP** and use a variable instead. Hardcoded values in production code are bugs waiting to happen.
