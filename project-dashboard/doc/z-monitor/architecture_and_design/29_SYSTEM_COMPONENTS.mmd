graph TB
    subgraph "Interface Layer - QML Views"
        LoginView[LoginView.qml]
        DashboardView[DashboardView.qml]
        TrendsView[TrendsView.qml]
        AlarmsView[AlarmsView.qml]
        SettingsView[SettingsView.qml]
        DiagnosticsView[DiagnosticsView.qml]
        PatientAdmissionModal[PatientAdmissionModal.qml]
    end

    subgraph "Interface Layer - QML Controllers"
        AuthenticationController[AuthenticationController]
        DashboardController[DashboardController]
        TrendsController[TrendsController]
        AlarmController[AlarmController]
        PatientController[PatientController]
        SettingsController[SettingsController]
        ProvisioningController[ProvisioningController]
        SystemController[SystemController]
        DiagnosticsController[DiagnosticsController]
        NotificationController[NotificationController]
    end

    subgraph "Application Layer - Services"
        SecurityService[SecurityService]
        PermissionRegistry[PermissionRegistry]
        MonitoringService[MonitoringService]
        AdmissionService[AdmissionService]
        ProvisioningService[ProvisioningService]
        DataArchiveService[DataArchiveService]
        FirmwareUpdateService[FirmwareUpdateService]
        BackupService[BackupService]
    end

    subgraph "Domain Layer - Aggregates & Events"
        PatientAggregate[PatientAggregate]
        DeviceAggregate[DeviceAggregate]
        TelemetryBatch[TelemetryBatch]
        AlarmAggregate[AlarmAggregate]
        AdmissionAggregate[AdmissionAggregate]
        ProvisioningSession[ProvisioningSession]
        UserSession[UserSession]
        DomainEvents[Domain Events:<br/>PatientAdmitted<br/>TelemetryQueued<br/>AlarmRaised<br/>ProvisioningCompleted]
    end

    subgraph "Domain Layer - Repository Interfaces"
        IPatientRepository[IPatientRepository]
        ITelemetryRepository[ITelemetryRepository]
        IVitalsRepository[IVitalsRepository]
        IAlarmRepository[IAlarmRepository]
        IProvisioningRepository[IProvisioningRepository]
        IUserRepository[IUserRepository]
        IAuditRepository[IAuditRepository]
    end

    subgraph "Domain Layer - External Service Interfaces"
        ISensorDataSource[ISensorDataSource]
        IPatientLookupService[IPatientLookupService]
        ITelemetryServer[ITelemetryServer]
        IProvisioningServiceInterface[IProvisioningService]
    end

    subgraph "Infrastructure Layer - Persistence"
        SQLitePatientRepository[SQLitePatientRepository]
        SQLiteTelemetryRepository[SQLiteTelemetryRepository]
        SQLiteVitalsRepository[SQLiteVitalsRepository]
        SQLiteAlarmRepository[SQLiteAlarmRepository]
        SQLiteProvisioningRepository[SQLiteProvisioningRepository]
        SQLiteUserRepository[SQLiteUserRepository]
        SQLiteAuditRepository[SQLiteAuditRepository]
        DatabaseManager[DatabaseManager<br/>SQLite + SQLCipher]
    end

    subgraph "Infrastructure Layer - Data Caching"
        VitalsCache[VitalsCache<br/>3-day in-memory]
        WaveformCache[WaveformCache<br/>30-sec circular]
        PersistenceScheduler[PersistenceScheduler<br/>Every 10 min]
        DataCleanupService[DataCleanupService<br/>Daily 3 AM]
    end

    subgraph "Infrastructure Layer - Sensor Data Sources"
        SharedMemorySensorDataSource[SharedMemorySensorDataSource<br/>ISensorDataSource]
        SimulatorDataSource[SimulatorDataSource<br/>ISensorDataSource]
        MockSensorDataSource[MockSensorDataSource<br/>ISensorDataSource]
        HardwareSensorAdapter[HardwareSensorAdapter<br/>ISensorDataSource]
    end

    subgraph "Infrastructure Layer - Network & External Services"
        NetworkTelemetryServer[NetworkTelemetryServer<br/>ITelemetryServer]
        MockTelemetryServer[MockTelemetryServer<br/>ITelemetryServer]
        HISPatientLookupAdapter[HISPatientLookupAdapter<br/>IPatientLookupService]
        MockPatientLookupService[MockPatientLookupService<br/>IPatientLookupService]
        CentralStationClient[CentralStationClient]
    end

    subgraph "Infrastructure Layer - Qt & Security Adapters"
        SettingsManager[SettingsManager]
        LogService[LogService]
        CertificateManager[CertificateManager]
        KeyManager[KeyManager]
        QRCodeGenerator[QRCodeGenerator]
        EncryptionService[EncryptionService]
        SignatureService[SignatureService]
        SecureStorage[SecureStorage]
        HealthMonitor[HealthMonitor]
        ClockSyncService[ClockSyncService]
        FirmwareManager[FirmwareManager]
        WatchdogService[WatchdogService]
    end

    subgraph "External Systems"
        CentralServer[Central Server<br/>HTTPS/mTLS]
        HISEHR[HIS/EHR<br/>REST API]
        CentralStation[Central Station<br/>Provisioning]
        SensorSimulator[Sensor Simulator<br/>Shared Memory Ring]
        NTPServer[NTP Server]
        CRLServer[CRL Server]
    end

    %% QML Views -> Controllers
    LoginView --> AuthenticationController
    DashboardView --> DashboardController
    DashboardView --> AlarmController
    TrendsView --> TrendsController
    AlarmsView --> AlarmController
    SettingsView --> SettingsController
    SettingsView --> ProvisioningController
    DiagnosticsView --> DiagnosticsController
    PatientAdmissionModal --> PatientController
    DashboardView --> PatientController
    DashboardView --> SystemController

    %% Controllers -> Application Services
    AuthenticationController --> SecurityService
    DashboardController --> MonitoringService
    TrendsController --> MonitoringService
    AlarmController --> MonitoringService
    PatientController --> AdmissionService
    ProvisioningController --> ProvisioningService
    SystemController --> SecurityService
    DiagnosticsController --> DataArchiveService

    %% Controllers -> Infrastructure (direct access for display)
    DashboardController --> VitalsCache
    DashboardController --> WaveformCache
    SettingsController --> SettingsManager
    DiagnosticsController --> LogService
    DiagnosticsController --> HealthMonitor

    %% Application Services -> Domain Aggregates
    SecurityService --> UserSession
    SecurityService -->|uses| PermissionRegistry
    MonitoringService --> PatientAggregate
    MonitoringService --> TelemetryBatch
    MonitoringService --> AlarmAggregate
    AdmissionService --> PatientAggregate
    AdmissionService --> AdmissionAggregate
    ProvisioningService --> DeviceAggregate
    ProvisioningService --> ProvisioningSession

    %% Application Services -> Repository Interfaces
    SecurityService --> IUserRepository
    SecurityService --> IAuditRepository
    MonitoringService --> ITelemetryRepository
    MonitoringService --> IVitalsRepository
    MonitoringService --> IAlarmRepository
    MonitoringService --> IPatientRepository
    AdmissionService --> IPatientRepository
    AdmissionService --> IAuditRepository
    ProvisioningService --> IProvisioningRepository
    DataArchiveService --> ITelemetryRepository
    DataArchiveService --> IVitalsRepository
    DataArchiveService --> IAlarmRepository
    BackupService --> IPatientRepository
    BackupService --> ITelemetryRepository
    BackupService --> IAlarmRepository

    %% Application Services -> External Service Interfaces
    MonitoringService --> ISensorDataSource
    MonitoringService --> ITelemetryServer
    AdmissionService --> IPatientLookupService
    ProvisioningService --> IProvisioningServiceInterface

    %% Domain Aggregates -> Domain Events
    PatientAggregate --> DomainEvents
    TelemetryBatch --> DomainEvents
    AlarmAggregate --> DomainEvents
    ProvisioningSession --> DomainEvents

    %% Repository Interfaces -> Implementations
    IPatientRepository --> SQLitePatientRepository
    ITelemetryRepository --> SQLiteTelemetryRepository
    IVitalsRepository --> SQLiteVitalsRepository
    IAlarmRepository --> SQLiteAlarmRepository
    IProvisioningRepository --> SQLiteProvisioningRepository
    IUserRepository --> SQLiteUserRepository
    IAuditRepository --> SQLiteAuditRepository

    %% External Service Interfaces -> Implementations
    ISensorDataSource --> SharedMemorySensorDataSource
    ISensorDataSource --> SimulatorDataSource
    ISensorDataSource --> MockSensorDataSource
    ISensorDataSource --> HardwareSensorAdapter
    ITelemetryServer --> NetworkTelemetryServer
    ITelemetryServer --> MockTelemetryServer
    IPatientLookupService --> HISPatientLookupAdapter
    IPatientLookupService --> MockPatientLookupService

    %% Repository Implementations -> DatabaseManager
    SQLitePatientRepository --> DatabaseManager
    SQLiteTelemetryRepository --> DatabaseManager
    SQLiteVitalsRepository --> DatabaseManager
    SQLiteAlarmRepository --> DatabaseManager
    SQLiteProvisioningRepository --> DatabaseManager
    SQLiteUserRepository --> DatabaseManager
    SQLiteAuditRepository --> DatabaseManager

    %% Data Caching Flow (PRIORITY 1: Critical Path)
    SharedMemorySensorDataSource --> VitalsCache
    SharedMemorySensorDataSource --> WaveformCache
    VitalsCache --> MonitoringService
    WaveformCache --> DashboardController

    %% Data Caching Flow (PRIORITY 3: Database Persistence)
    PersistenceScheduler --> VitalsCache
    PersistenceScheduler --> SQLiteVitalsRepository
    DataCleanupService --> SQLiteVitalsRepository

    %% Application Services -> Infrastructure Adapters
    ProvisioningService --> CentralStationClient
    ProvisioningService --> QRCodeGenerator
    ProvisioningService --> EncryptionService
    ProvisioningService --> CertificateManager
    SecurityService --> SignatureService
    SecurityService --> SecureStorage
    SecurityService --> KeyManager
    MonitoringService --> SignatureService
    BackupService --> EncryptionService
    FirmwareUpdateService --> FirmwareManager
    FirmwareUpdateService --> SignatureService

    %% Infrastructure -> External Systems
    NetworkTelemetryServer --> CentralServer
    HISPatientLookupAdapter --> HISEHR
    CentralStationClient --> CentralStation
    SharedMemorySensorDataSource --> SensorSimulator
    ClockSyncService --> NTPServer
    CertificateManager --> CRLServer

    %% Infrastructure cross-dependencies
    SettingsManager --> DatabaseManager
    LogService --> DatabaseManager
    HealthMonitor --> LogService
    WatchdogService --> LogService

    %% Styling
    classDef qmlView fill:#e1f5ff,stroke:#0288d1,stroke-width:2px
    classDef controller fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    classDef appService fill:#c8e6c9,stroke:#388e3c,stroke-width:2px
    classDef domain fill:#f8bbd0,stroke:#c2185b,stroke-width:2px
    classDef interface fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px
    classDef repository fill:#d1c4e9,stroke:#512da8,stroke-width:2px
    classDef caching fill:#fff9c4,stroke:#f57f17,stroke-width:3px
    classDef infrastructure fill:#ffccbc,stroke:#d84315,stroke-width:2px
    classDef external fill:#b0bec5,stroke:#37474f,stroke-width:3px

    class LoginView,DashboardView,TrendsView,AlarmsView,SettingsView,DiagnosticsView,PatientAdmissionModal qmlView
    class AuthenticationController,DashboardController,TrendsController,AlarmController,PatientController,SettingsController,ProvisioningController,SystemController,DiagnosticsController,NotificationController controller
    class SecurityService,PermissionRegistry,MonitoringService,AdmissionService,ProvisioningService,DataArchiveService,FirmwareUpdateService,BackupService appService
    class PatientAggregate,DeviceAggregate,TelemetryBatch,AlarmAggregate,AdmissionAggregate,ProvisioningSession,UserSession,DomainEvents domain
    class ISensorDataSource,IPatientLookupService,ITelemetryServer,IProvisioningServiceInterface interface
    class IPatientRepository,ITelemetryRepository,IVitalsRepository,IAlarmRepository,IProvisioningRepository,IUserRepository,IAuditRepository repository
    class VitalsCache,WaveformCache,PersistenceScheduler,DataCleanupService caching
    class SQLitePatientRepository,SQLiteTelemetryRepository,SQLiteVitalsRepository,SQLiteAlarmRepository,SQLiteProvisioningRepository,SQLiteUserRepository,SQLiteAuditRepository,DatabaseManager,NetworkTelemetryServer,MockTelemetryServer,HISPatientLookupAdapter,MockPatientLookupService,CentralStationClient,SharedMemorySensorDataSource,SimulatorDataSource,MockSensorDataSource,HardwareSensorAdapter,SettingsManager,LogService,CertificateManager,KeyManager,QRCodeGenerator,EncryptionService,SignatureService,SecureStorage,HealthMonitor,ClockSyncService,FirmwareManager,WatchdogService infrastructure
    class CentralServer,HISEHR,CentralStation,SensorSimulator,NTPServer,CRLServer external
